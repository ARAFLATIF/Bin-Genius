<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Dumpster Status</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="demo.css">
</head>
<body>

<!-- Main Container -->
<div class="container mt-5">
    <h2 class="text-center mb-4">ESP32 Dumpster Status</h2>
    
    <!-- Dumpster Status Card -->
    <div class="card">
        <div class="card-body">
            <h5 class="card-title"><i class="fas fa-dumpster"></i> Dumpster Status</h5>
            <p class="card-text">
                <strong>Location:</strong> 123 Main St<br>
                <strong>Fill Level:</strong> <span id="fill-level-text">70%</span><br>
                <strong>Last Updated:</strong> <span id="last-updated-text">Just now</span>
            </p>
            <div class="progress mb-3">
                <div class="progress-bar bg-success" role="progressbar" style="width: 70%;" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
            <button class="btn btn-outline-primary btn-sm" data-toggle="modal" data-target="#detailsModal">View Details</button>
        </div>
    </div>

    <!-- Activity Log -->
    <div class="mt-4">
        <h5>Recent Activity</h5>
        <ul class="list-group" id="activity-log">
            <li class="list-group-item">Updated fill level: 70% at 10:00 AM</li>
            <li class="list-group-item">Checked status at 9:45 AM</li>
            <li class="list-group-item">Last emptied on 10/25/2024</li>
        </ul>
    </div>
</div>

<!-- Modal for Details -->
<div class="modal fade" id="detailsModal" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detailsModalLabel">Dumpster Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <strong>Location:</strong> 123 Main St<br>
                <strong>Fill Level:</strong> <span id="modal-fill-level">70%</span><br>
                <strong>Last Updated:</strong> <span id="modal-last-updated">Just now</span><br>
                <strong>Last Emptied:</strong> 10/25/2024<br>
                <strong>Capacity:</strong> 1000L<br>
                <strong>Notes:</strong> Needs cleaning soon.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="mt-5 text-center">
    <p>&copy; 2024 Dumpster Management System. All rights reserved.</p>
</footer>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="demo.js"></script>

<script>
// JavaScript code to dynamically update the progress bar
document.addEventListener("DOMContentLoaded", function() {
    const progressBar = document.querySelector('.progress-bar');
    const fillLevelText = document.getElementById('fill-level-text');
    const modalFillLevel = document.getElementById('modal-fill-level');
    const lastUpdatedText = document.getElementById('last-updated-text');
    const modalLastUpdated = document.getElementById('modal-last-updated');
    const activityLog = document.getElementById('activity-log');

    // Function to update the progress bar
    function updateProgressBar(level) {
        progressBar.style.width = level + '%';
        progressBar.setAttribute('aria-valuenow', level);
        fillLevelText.textContent = level + '%';
        modalFillLevel.textContent = level + '%';
        lastUpdatedText.textContent = new Date().toLocaleTimeString(); // Update last updated time
        modalLastUpdated.textContent = new Date().toLocaleTimeString();

        // Remove existing color classes
        progressBar.classList.remove('bg-success', 'bg-warning', 'bg-danger');

        // Change the color of the progress bar based on the fill level
        if (level <= 50) {
            progressBar.classList.add('bg-success'); // Green for 0-50%
        } else if (level <= 80) {
            progressBar.classList.add('bg-warning'); // Yellow for 51-80%
        } else {
            progressBar.classList.add('bg-danger'); // Red for above 80%
        }

        // Add new activity log entry
        const logEntry = document.createElement('li');
        logEntry.classList.add('list-group-item');
        logEntry.textContent = `Updated fill level: ${level}% at ${new Date().toLocaleTimeString()}`;
        activityLog.appendChild(logEntry);
    }

    // Function to fetch fill level from the ESP32
    function fetchFillLevel() {
        fetch('http://192.168.1.106:1880/update-sensor') // Update this URL to your Node-RED endpoint
            .then(response => response.json())
            .then(data => {
                const level = parseInt(data.distance); // Assuming distance is used as the fill level
                updateProgressBar(level);
            })
            .catch(error => console.error('Error fetching fill level:', error));
    }

    // Fetch fill level every 5 seconds
    setInterval(fetchFillLevel, 5000);
    fetchFillLevel(); // Initial fetch
});
</script>
</body>
</html>
